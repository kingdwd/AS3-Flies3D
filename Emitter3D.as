package {		import flash.events.*;		public class Emitter3D extends SpringyNode3D {		private var pSystem:ParticleSystem3D;				private var bMoveDepth = false;		private var startDepth = 0;				private var circleFreq:Number= 0.002;		private var circleRadius:Number= 200;				public function Emitter3D(t_pSystem:ParticleSystem3D) {			super();			pSystem = t_pSystem;			k = .5;			d = k * 2;			addEventListener(Event.ADDED_TO_STAGE, addedToStage);		}						private function addedToStage(e:Event) {			stage.addEventListener(KeyboardEvent.KEY_DOWN, onKeyPress);			stage.addEventListener(KeyboardEvent.KEY_UP, onKeyRelease);					}				private function onKeyPress(e:KeyboardEvent) {			if(e.charCode == 32 && !bMoveDepth) {				bMoveDepth = true;				startDepth = pSystem.mouseY - target.z;			}		}				private function onKeyRelease(e:KeyboardEvent) {			if(e.charCode == 32) bMoveDepth = false;		}												override public function update() {			var tx:Number = (pSystem.mouseX - stage.stageWidth/2) / invZ + stage.stageWidth/2;			var ty:Number = (pSystem.mouseY - stage.stageHeight/2) / invZ + stage.stageHeight/2;						if(bMoveDepth) setTarget3(tx, target.y, pSystem.mouseY - startDepth);			else setTarget3(tx, ty, target.z);						rotation = vel.x/2;					//vel.z += (Math.random() - 0.5) * (vel.x*vel.x + vel.y*vel.y) * 0.05;						super.update();		}					}}